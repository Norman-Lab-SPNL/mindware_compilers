# mindware_compilers

Hi SPNL (and other Mindware users)!

Here are short instructions for how to use the R Mindware Compiler script. This script provides a `compile()` function designed to combine Mindware output files generated by Mindware's "HRV", "IMP", or "EDA" software.  

## Step 1  
Ensure all your Mindware output files (in .xlsx format) are in a single directory (aka folder).   
  
## Step 2  
Make sure you've installed the following packages as they are dependencies of the compiler. You can install them with `install.packages("<package name>")`.  
  
* `tidyverse`  
* `readxl`  
  
## Step 3  
Call the compiler script by including the following line of code at the top of your analysis file:  

```
source("mindware_compiler.R")
```
  
*Note: Make sure `mindware_compiler.R` is saved to the same directory as your analysis file (or include the full directory address when calling the compiler file in `source()` and include `chdir = TRUE` as an argument in the `source()` function.*  
  
```
source("dir/to/file/mindware_compiler.R", chdir = TRUE)
```
  
## Step 4 
Call the compile function. The function takes the following arguments:  

* `directory`: If the data files are in a separate folder within the directory (or in a separate directory altogether), you can use this argument to override the default (which is the current working directory).  
*Note: Make sure the directory your data files live in includes no extraneous excel/csv files so they don't get read in by the function against your will.*  
* `physio_type`: A character string indicating the type of Mindware physiology software used to generate the excel files to be compiled. Options are "HRV" (default), "IMP", "EDA".  
* `vars_to_keep`: a vector containing each of the variables you wish to extract from the data as individual character strings. For example, `c("RSA", "RMSSD")` if compiling HRV data or `c("PEP")` if compiling IMP data.  
*Note: Make sure the names match exactly with the way they appear in the excel files that Mindware spits out so you don't get an error.*  
* `software_version`: A character string indicating the version of the Mindware software used to generate the output excel files. Options that are currently supported are "3.2" (default) and "3.1".  
* `resp_range` (for HRV data only): A vector (`c(lower_bound, upper_bound)`) with the lower and upper bounds of the range of acceptable respiration rates (in Hz). The function will check whether respiration rates were collected. If respiration rates are reported in the data, the function will return an extra column (`resp_within_range`) with a value of 1 for each segment where the respiration rate is within the `resp_range`, 0 if it is not, or `NA` if the respiration rate was not recorded for that segment. The default value for `resp_range` is 0.12-0.4 Hz.  
  
#### Sample Usage  
  
##### Here is the function call to compile HRV and RMSSD for data scored using HRV software version 3.2.13:  

```
full_data_df <- compile(
  directory = "dir/to/data", 
  physio_type = "HRV", 
  vars_to_keep = c("HRV", "RMSSD"), 
  software_version = "3.2", 
  resp_range = c(0.12, 0.4))
```  
  
##### Here is the function call to compile PEP for data scored using IMP software version 3.1.5 and also extracting the timestamps for each segment:  

```
full_data_df <- compile(
  directory = "dir/to/data", 
  physio_type = "IMP", 
  vars_to_keep = c("PEP", "Start Time", "End Time"), 
  software_version = "3.1")
```  

*Note that "Start Time" and "End Time" match the variable names in the excel output files exactly.*  
  
## Step 5  
The `compile()` function will return the compiled dataframe (in the examples above called `full_data_df`) in long format so that each row represents a single segment from a single output file. Apart from the variables you entered as `vars_to_keep`, the dataframe will contain the following additional columns:  
  
* `mwi_filename`: The name of the original .mwi file that was read into the Mindware software and scored to generate the output excel file being compiled.  
* `excel_filename`: The name of the output excel file being compiled.  
* `segment`: An integer indicating the segment number for the file being compiled.  
* `resp_within_range` (for HRV data only): A value of 1 for each segment where the respiration rate is within the `resp_range`, 0 if it is not, or `NA` if the respiration rate was not recorded for that segment.  
  
Now you can continue to process the dataframe or save it as a csv file:  

```
write_csv(full_data_df, "full_data_df.csv")
```  

*Feedback is appreciated! For any questions or suggestions, email ar277@uchicago.edu or [submit a GitHub issue](https://github.com/Norman-Lab-SPNL/mindware_compilers).*  
  
